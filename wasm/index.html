<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>altius inference on web!</title>
    <style>
      canvas {
        width: 224px;
        height: 224px;
        border: 1px solid;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas">
      <!-- Show the loaded image here -->
    </canvas>
    <div>
      <div>
        Image:
        <input id="img" name="img" type="file" />
      </div>
      <div>
        ONNX Model:
        <input id="file" name="file" type="file" />
      </div>
    </div>
    <div id="results">
      Select an image for classification first. After that, by selecting a ONNX
      model you want to run, the inference session starts.
    </div>

    <script type="module">
      import init, { load_and_run } from "./pkg/altius_wasm.js";

      init();

      let loaded_image;
      let canvas = document.getElementById("canvas");
      let context = canvas.getContext("2d");

      window.addEventListener("DOMContentLoaded", function () {
        document.querySelector("#img").addEventListener(
          "change",
          function (e) {
            let file = document.querySelector("#img").files[0];
            let fileReader = new FileReader();

            fileReader.onload = (evt) => {
              loaded_image = new Uint8Array(evt.target.result);

              let image = new Image();
              image.src = URL.createObjectURL(new Blob([loaded_image]));
              image.onload = function () {
                context.drawImage(image, 0, 0, canvas.width, canvas.height);
              };
            };
            fileReader.readAsArrayBuffer(file);
          },
          true
        );

        document.querySelector("#file").addEventListener(
          "change",
          function (e) {
            let file = document.querySelector("#file").files[0];
            let fileReader = new FileReader();

            fileReader.onload = (evt) => {
              let onnx = new Uint8Array(evt.target.result);
              let res = load_and_run(onnx, loaded_image);
              document.getElementById("results").innerHTML = res;
            };
            fileReader.readAsArrayBuffer(file);
          },
          true
        );
      });
    </script>
  </body>
</html>
